<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        * {
            margin: 0px;
            padding: 0px;
        }

        a {
            text-decoration: none;
            color: inherit;
            cursor: pointer;
        }

        body {

            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;

        }

        main {
            border: 1px solid rgb(95, 95, 95);
            width: 100%;
            aspect-ratio: 1275/590;
            /* width: 1275px;
             height: 590px; */
            position: fixed;
            background-color: white;

        }


        .board {
            box-sizing: border-box;
            position: absolute;
            left: 13%;
            top: 14%;
            width: 62%;
            height: 80%;

            border: 1px solid red;

        }

        /* Estilos para as células do tabuleiro */
        .cell {
            box-sizing: border-box;
            border: 1px solid rgb(0, 68, 255);
            width: 10%;
            height: 100%;
            position: relative;

        }

        .row {
            box-sizing: border-box;
            width: 100%;
            height: 20%;
            display: flex;

        }



        /* Controle mouse  */


        #follow-image {
            position: absolute;
            z-index: -1;
            width: 2.1%;
            height: 2.1%;
            transition: left 0.05s, top 0.05s;
            /* Adiciona transição para suavizar o movimento */
        }




        .superior-esrquedo,
        .superior-direito,
        .inferior-esrquedo,
        .inferior-direito {
            background-image: url(../seletorAzul.png);
            background-repeat: no-repeat;
            background-size: 65%;
            width: 50%;
            height: 50%;
            position: absolute;
        }

        #conteudo1 {

            z-index: 5;

            /* Remova a propriedade position: relative; */
            position: absolute;
            /* Adicione position: absolute; */
            left: 0;
            /* Adicione left: 0; */
            top: 0;
            /* Adicione top: 0; */
            width: 100%;
            /* Adicione width: 100%; */
            height: 100%;
            /* Adicione height: 100%; */
            border: 1px solid green;
        }

        .superior-direito {
            background-position: left top;
            transform: scaleX(-1);
            right: 0;
        }

        .inferior-esrquedo {
            transform: scaleY(-1);
            bottom: 0;
        }

        .inferior-direito {
            background-position: left top;
            transform: scale(-1);
            right: 0;
            bottom: 0;
        }
    </style>
</head>

<body>



    <main>

        <img id="follow-image" src="../seletorTrianguloAzul.png" alt="Imagem a seguir o mouse">



        <div class="tabuleiro normal conteudo board" id="conteudo2">



            <div class="row linha1">
                <div class="cell grass-cutter">C</div>

                <div class="cell plant" id="cell1">


                    <div id="conteudo1">
                        <div class="superior-esrquedo"></div>
                        <div class="superior-direito"></div>
                        <div class="inferior-esrquedo"></div>
                        <div class="inferior-direito"></div>
                    </div>

                </div>
                <div class="cell">-</div>
                <div class="cell">-</div>
                <div class="cell">-</div>
                <div class="cell">-</div>
                <div class="cell">-</div>
                <div class="cell">-</div>
                <div class="cell zombie">Z</div>
                <div class="cell">-</div>
            </div>
            <div class="row linha2">
                <div class="cell grass-cutter">C</div>
                <div class="cell">-</div>
                <div class="cell">-</div>
                <div class="cell">-</div>
                <div class="cell">-</div>
                <div class="cell">-</div>
                <div class="cell">-</div>
                <div class="cell">-</div>
                <div class="cell">-</div>
                <div class="cell">-</div>
            </div>
            <div class="row linha3">
                <div class="cell grass-cutter">C</div>
                <div class="cell">-</div>
                <div class="cell">-</div>
                <div class="cell">-</div>
                <div class="cell">-</div>
                <div class="cell">-</div>
                <div class="cell">-</div>
                <div class="cell">-</div>
                <div class="cell">-</div>
                <div class="cell">-</div>
            </div>
            <div class="row linha4">
                <div class="cell grass-cutter">C</div>
                <div class="cell">-</div>
                <div class="cell">-</div>
                <div class="cell">-</div>
                <div class="cell">-</div>
                <div class="cell">-</div>
                <div class="cell">-</div>
                <div class="cell">-</div>
                <div class="cell">-</div>
                <div class="cell">-</div>
            </div>
            <div class="row linha5">
                <div class="cell grass-cutter">C</div>
                <div class="cell">-</div>
                <div class="cell">-</div>
                <div class="cell">-</div>
                <div class="cell">-</div>
                <div class="cell">-</div>
                <div class="cell">-</div>
                <div class="cell">-</div>
                <div class="cell">-</div>
                <div class="cell">-</div>
            </div>
        </div>

    </main>


    <script src="mouse.js"></script>
    <script src="teclado.js"></script>




    <script>
        let analogThreshold = 0.3; // Limiar para considerar movimento do analógico
        let analogMoveSpeed = 0.3; // Velocidade de movimento do analógico

        var teste = true;

        const rect = celulaAtual.getBoundingClientRect();
        const mainRect = main.getBoundingClientRect();
        const centerXPercentage =
            ((rect.left - mainRect.left + rect.width / 2 - imagem.width / 2) /
                mainRect.width) *
            100;
        const centerYPercentage =
            ((rect.top - mainRect.top) / mainRect.height) * 100;



        let analogMoveX = centerXPercentage;
        let analogMoveY = centerYPercentage;

        var moveTimeout2;







        function updateImagePosition(gamepad) {
            if (
                Math.abs(gamepad.axes[0]) > analogThreshold ||
                Math.abs(gamepad.axes[1]) > analogThreshold
            ) {
                analogMoveX += gamepad.axes[0] * analogMoveSpeed;
                analogMoveY += gamepad.axes[1] * analogMoveSpeed;


                // Converte as porcentagens para pixels
                var rect3 = conteudo2.getBoundingClientRect();

                var rectImage = imagem.getBoundingClientRect();

                // Convertendo a porcentagem para pixels
                var marginPercentLeft = (rect3.width * 10) / 100;
                var marginPercentBottom = (rect3.height * 8) / 100;

                var isInsideContent2 = (
                    rectImage.left >= rect3.left + marginPercentLeft &&
                    rectImage.right <= rect3.right &&
                    rectImage.top >= rect3.top &&
                    rectImage.bottom <= rect3.bottom - marginPercentBottom
                );




                // Limita o movimento dentro de conteudo2
                analogMoveX = Math.min(Math.max(analogMoveX, 17.5), 75.5);
                analogMoveY = Math.min(Math.max(analogMoveY, 11.5), 85);




                imagem.style.left = `${analogMoveX}%`;
                imagem.style.top = `${analogMoveY}%`;



                var rect4 = celulaAtual.getBoundingClientRect();


                // Convertendo a porcentagem para pixels
                var marginPercentBottom5 = (rect4.height * 30) / 100;

                var isInsideContent3 = (
                    rectImage.left >= rect4.left &&
                    rectImage.right <= rect4.right &&
                    rectImage.top >= rect4.top &&
                    rectImage.bottom <= rect4.bottom - marginPercentBottom5
                );

                if (!isInsideContent3) {

                    console.log("esquedar celula Atual: " + rect4.left)
                    console.log("esquedar tabuleiro: " + rect3.left)
                    console.log(rectImage.left)
                    console.log("direta celula Atual: " + rect4.right)
                    console.log("direita tabuleiro: " + rect3.right)
                    console.log(rectImage.right)
                    console.log("top celula Atual: " + rect4.top)
                    console.log("top tabuleiro: " + rect3.top)
                    console.log(rectImage.top)
                    console.log("botom celula Atual: " + (rect4.bottom - marginPercentBottom5))
                    console.log(rectImage.bottom)
                }
                // Envie para a próxima célula (chame a função moveContent com a direção desejada)


                if (!isInsideContent3) {

                    console.log(teste)

                    if (teste) {

                        if (rectImage.top < (rect4.top - (rect4.height * 10) / 100) && rectImage.top > rect3.top) {


                            if (rectImage.right > rect4.right - (rect4.width * 20) / 100 && rectImage.right < rect3.right) {
                                moveContent('arrowupright');
                            }
                            else if (rectImage.left < rect4.left + (rect4.width * 20) / 100 && rectImage.left > rect3.left + marginPercentLeft) {
                                moveContent('arrowupleft');



                            }
                            else {
                                moveContent('arrowup');
                            }




                            const rect = celulaAtual.getBoundingClientRect();
                            const mainRect = main.getBoundingClientRect();
                            const centerYPercentage =
                                ((rect.top - mainRect.top + rect.height / 2 - imagem.height / 2) /
                                    mainRect.height) *
                                100;



                            const centerXPercentage =
                                ((rect.left - mainRect.left + rect.width / 2 - imagem.width / 2) /
                                    mainRect.width) *
                                100;





                            analogMoveY = centerYPercentage;






                        }


                        else if (rectImage.bottom > rect4.bottom - marginPercentBottom5) {

                            // Adjust the starting position of the image based on the center of the current cell

                            // Verifica se a imagem está dentro dos limites da div celulaatual
                            // analogMoveX = Math.min(Math.max(x, 0), tamanhoCelulaAtual);
                            // analogMoveY = Math.min(Math.max(y, 0), tamanhoCelulaAtual);

                            if (rectImage.right > rect4.right && rectImage.right < rect3.right) {
                                moveContent('arrowdownright');
                            }
                            else if (rectImage.left < rect4.left && rectImage.left > rect3.left + marginPercentLeft) {
                                moveContent('arrowdownleft');



                            }
                            else {
                                moveContent('arrowdown');
                            }








                            const rect = celulaAtual.getBoundingClientRect();
                            const mainRect = main.getBoundingClientRect();

                            const centerYPercentage =
                                ((rect.top - mainRect.top) / mainRect.height) * 100;




                            const centerXPercentage =
                                ((rect.left - mainRect.left + rect.width / 2 - imagem.width / 2) /
                                    mainRect.width) *
                                100;


                            analogMoveY = centerYPercentage;








                        }
                        else if (rectImage.right > rect4.right && rectImage.right < rect3.right) {



                            moveContent('arrowright');




                        } else if (rectImage.left < rect4.left && rectImage.left > rect3.left + marginPercentLeft) {

                            moveContent('arrowleft');

                        }







                    }

                }
            }

            else {


                // Calculate the center of the current cell in percentages
                const rect = celulaAtual.getBoundingClientRect();
                const mainRect = main.getBoundingClientRect();
                const centerXPercentage =
                    ((rect.left - mainRect.left + rect.width / 2 - imagem.width / 2) /
                        mainRect.width) *
                    100;
                const centerYPercentage =
                    ((rect.top - mainRect.top) / mainRect.height) * 100;

                // Adjust the starting position of the image based on the center of the current cell

                // Verifica se a imagem está dentro dos limites da div celulaatual
                // analogMoveX = Math.min(Math.max(x, 0), tamanhoCelulaAtual);
                // analogMoveY = Math.min(Math.max(y, 0), tamanhoCelulaAtual);
                centerImage(celulaAtual);

                analogMoveX = centerXPercentage;
                analogMoveY = centerYPercentage;
            }
        }

        function handleGamepad() {
            const gamepads = navigator.getGamepads();
            const gamepad = gamepads[0];

            if (gamepad) {
                updateImagePosition(gamepad);
            }

            requestAnimationFrame(handleGamepad);
        }

        window.addEventListener('gamepadconnected', (event) => {
            console.log(`Gamepad connected at index ${event.gamepad.index}`);
            handleGamepad();
        });

        window.addEventListener('gamepaddisconnected', (event) => {
            console.log(`Gamepad disconnected from index ${event.gamepad.index}`);
        });


        handleGamepad();



    </script>
</body>

</html>